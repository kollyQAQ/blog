[TOC]

## go vet | 检查代码中常见的错误

这个命令不会帮助开发人员写代码，但是它也很有用，因为它会帮助我们检查我们代码中常见的错误。

1. Printf 这类的函数调用时，类型匹配了错误的参数。
2. 定义常用的方法时，方法签名错误。
3. 错误的结构标签。
4. 没有指定字段名的结构字面量。

```go
package main

import (
	"fmt"
)

func main() {
	fmt.Printf(" 哈哈",3.14)
}
```

这个例子是一个明显错误的例子，新手经常会犯，这里我们忘记输入了格式化的指令符，这种编辑器是检查不出来的，但是如果我们使用 `go vet` 就可以帮我们检查出这类常见的小错误。

```bash
➜  hello go vet
main.go:8: no formatting directive in Printf call
```

看，提示多明显。其使用方式和 `go fmt` 一样，也是接受一个包名作为参数。

```
usage: go vet [-n] [-x] [build flags] [packages]
```

养成在代码提交或者测试前，使用 `go vet` 检查代码的好习惯，可以避免一些常见问题。



## godoc | 快速生成文档以及查看文档

控制台输入

```bash
godoc -http=:6060
```

浏览器打开：http://localhost:6060/



## go build -race | 检测资源竞争

共享资源竞争的问题，非常复杂，并且难以察觉，好在 Go 为我们提供了一个工具帮助我们检查，这个就是 `go build -race` 命令。我们在当前项目目录下执行这个命令，生成一个可以执行文件，然后再运行这个可执行文件，就可以看到打印出的检测信息。

```bash
go build -race
```

多加了一个 `-race` 标志，这样生成的可执行程序就自带了检测资源竞争的功能，下面我们运行，也是在终端运行。

```bash
./hello
```

我这里示例生成的可执行文件名是 `hello`，所以是这么运行的，这时候，我们看终端输出的检测结果。

```bash
➜  hello ./hello       
==================
WARNING: DATA RACE
Read at 0x0000011a5118 by goroutine 7:
  main.incCount()
      /Users/xxx/code/go/src/flysnow.org/hello/main.go:25 +0x76

Previous write at 0x0000011a5118 by goroutine 6:
  main.incCount()
      /Users/xxx/code/go/src/flysnow.org/hello/main.go:28 +0x9a

Goroutine 7 (running) created at:
  main.main()
      /Users/xxx/code/go/src/flysnow.org/hello/main.go:17 +0x77

Goroutine 6 (finished) created at:
  main.main()
      /Users/xxx/code/go/src/flysnow.org/hello/main.go:16 +0x5f
==================
4
Found 1 data race(s)
```

看，找到一个资源竞争，连在那一行代码出了问题，都标示出来了。goroutine 7 在代码 25 行读取共享资源 `value := count`, 而这时 goroutine 6 正在代码 28 行修改共享资源 `count = value`, 而这两个 goroutine 都是从 main 函数启动的，在 16、17 行，通过 `go` 关键字。